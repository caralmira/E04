{% load static %}
<!DOCTYPE html>

<html>
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>{{title}}</title>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
    </head>

    {% block content %}
    <style>
        
    </style>

    <body>
        <!-- {% block navbar %} 

        {% endblock navbar %} -->

        <main>
            <div style = "padding: 5%;">
                <div class = "accordion" id = "accordionExample">
                    {% include 'question.html' %}
                </div>
            </div>

            {% block ask %}

            {% endblock ask %}
        </main>

        <script>
            $("#btncreate").click(function () {
                let question = $("#question_id").val();
                let csr = $("input[name=csrfmiddlewaretoken").val();
                if ( question == null) {
                    console.log("Ask a question!")
                } else {
                    console.log(question)
                    output = ""
                    question_data = {
                        question: question,
                        csrfmiddlewaretoken: csr
                    };
                    $.ajax({
                        url: "create_question/",
                        method: "POST",
                        data: question_data,
                        success: function(data) {
                            console.log(data);
                            question_list = data.question_data;
                            if (data.form_is_valid == true) {
                                console.log("Question submitted successfully")
                                for (i = 0; i < question_list.length; i++) {
                                    output += `<div class = "accordion-item"><h2 class = "accordion-header" id = "heading` + question_list[i].id + 
                                    `"><button id = "accord" class = "accordion-button" type = "button" data-bs-toggle = "collapse" data-bs-target = "#collapse` + question_list[i].id +
                                    `" aria-expanded = "true" aria-controls="collapse` + question_list[i].id + `">` 
                                    + question_list[i].question + `</button></h2><div id = "collapse` + question_list[i].id +
                                    `" class = "accordion-collapse collapse" aria-labelledby = "heading` + question_list[i].id + 
                                    `" data-bs-parent = "#accordionExample"><div class = "accordion-body"><strong> Answer: </strong>` + question_list[i].answer +
                                    `</div></div></div>`
                                }
                                $("#accordionExample").html(output);
                                $("form")[0].reset();
                            }
                        },
                    });
                } 
            });
        </script>

    </body>
    {% endblock content %}
    
</html>